{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/Farhan/Desktop/WebDevelopment/Projects/Learnify/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _objectSpread from\"C:/Users/Farhan/Desktop/WebDevelopment/Projects/Learnify/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"C:/Users/Farhan/Desktop/WebDevelopment/Projects/Learnify/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import{toast}from\"react-hot-toast\";import{studentEndpoints}from\"../apis\";import{apiConnector}from\"../apiconnector\";import rzpLogo from\"../../assets/Logo/rzp_logo.png\";import{setPaymentLoading}from\"../../slices/courseSlice\";import{resetCart}from\"../../slices/cartSlice\";var COURSE_PAYMENT_API=studentEndpoints.COURSE_PAYMENT_API,COURSE_VERIFY_API=studentEndpoints.COURSE_VERIFY_API,SEND_PAYMENT_SUCCESS_EMAIL_API=studentEndpoints.SEND_PAYMENT_SUCCESS_EMAIL_API;function loadScript(src){return new Promise(function(resolve){var script=document.createElement(\"script\");script.src=src;script.onload=function(){resolve(true);};script.onerror=function(){resolve(false);};document.body.appendChild(script);});}export function buyCourse(_x,_x2,_x3,_x4,_x5){return _buyCourse.apply(this,arguments);}function _buyCourse(){_buyCourse=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(token,courses,userDetails,navigate,dispatch){var toastId,res,orderResponse,options,paymentObject;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:toastId=toast.loading(\"Loading...\");_context.prev=1;_context.next=4;return loadScript(\"https://checkout.razorpay.com/v1/checkout.js\");case 4:res=_context.sent;if(res){_context.next=8;break;}toast.error(\"RazorPay SDK failed to load\");return _context.abrupt(\"return\");case 8:_context.next=10;return apiConnector(\"POST\",COURSE_PAYMENT_API,{courses:courses},{Authorization:\"Bearer \".concat(token)});case 10:orderResponse=_context.sent;if(orderResponse.data.success){_context.next=13;break;}throw new Error(orderResponse.data.message);case 13:console.log(\"PRINTING orderResponse\",orderResponse);//options\noptions={key:process.env.RAZORPAY_KEY,currency:orderResponse.data.message.currency,amount:\"\".concat(orderResponse.data.message.amount),order_id:orderResponse.data.message.id,name:\"StudyNotion\",description:\"Thank You for Purchasing the Course\",image:rzpLogo,prefill:{name:\"\".concat(userDetails.firstName),email:userDetails.email},handler:function handler(response){//send successful wala mail\nsendPaymentSuccessEmail(response,orderResponse.data.message.amount,token);//verifyPayment\nverifyPayment(_objectSpread(_objectSpread({},response),{},{courses:courses}),token,navigate,dispatch);}};//miss hogya tha \npaymentObject=new window.Razorpay(options);paymentObject.open();paymentObject.on(\"payment.failed\",function(response){toast.error(\"oops, payment failed\");console.log(response.error);});_context.next=24;break;case 20:_context.prev=20;_context.t0=_context[\"catch\"](1);console.log(\"PAYMENT API ERROR.....\",_context.t0);toast.error(\"Could not make Payment\");case 24:toast.dismiss(toastId);case 25:case\"end\":return _context.stop();}},_callee,null,[[1,20]]);}));return _buyCourse.apply(this,arguments);}function sendPaymentSuccessEmail(_x6,_x7,_x8){return _sendPaymentSuccessEmail.apply(this,arguments);}//verify payment\nfunction _sendPaymentSuccessEmail(){_sendPaymentSuccessEmail=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(response,amount,token){return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return apiConnector(\"POST\",SEND_PAYMENT_SUCCESS_EMAIL_API,{orderId:response.razorpay_order_id,paymentId:response.razorpay_payment_id,amount:amount},{Authorization:\"Bearer \".concat(token)});case 3:_context2.next=8;break;case 5:_context2.prev=5;_context2.t0=_context2[\"catch\"](0);console.log(\"PAYMENT SUCCESS EMAIL ERROR....\",_context2.t0);case 8:case\"end\":return _context2.stop();}},_callee2,null,[[0,5]]);}));return _sendPaymentSuccessEmail.apply(this,arguments);}function verifyPayment(_x9,_x10,_x11,_x12){return _verifyPayment.apply(this,arguments);}function _verifyPayment(){_verifyPayment=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(bodyData,token,navigate,dispatch){var toastId,response;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:toastId=toast.loading(\"Verifying Payment....\");dispatch(setPaymentLoading(true));_context3.prev=2;_context3.next=5;return apiConnector(\"POST\",COURSE_VERIFY_API,bodyData,{Authorization:\"Bearer \".concat(token)});case 5:response=_context3.sent;if(response.data.success){_context3.next=8;break;}throw new Error(response.data.message);case 8:toast.success(\"payment Successful, ypou are addded to the course\");navigate(\"/dashboard/enrolled-courses\");dispatch(resetCart());_context3.next=17;break;case 13:_context3.prev=13;_context3.t0=_context3[\"catch\"](2);console.log(\"PAYMENT VERIFY ERROR....\",_context3.t0);toast.error(\"Could not verify Payment\");case 17:toast.dismiss(toastId);dispatch(setPaymentLoading(false));case 19:case\"end\":return _context3.stop();}},_callee3,null,[[2,13]]);}));return _verifyPayment.apply(this,arguments);}","map":{"version":3,"names":["toast","studentEndpoints","apiConnector","rzpLogo","setPaymentLoading","resetCart","COURSE_PAYMENT_API","COURSE_VERIFY_API","SEND_PAYMENT_SUCCESS_EMAIL_API","loadScript","src","Promise","resolve","script","document","createElement","onload","onerror","body","appendChild","buyCourse","_x","_x2","_x3","_x4","_x5","_buyCourse","apply","arguments","_asyncToGenerator","_regeneratorRuntime","mark","_callee","token","courses","userDetails","navigate","dispatch","toastId","res","orderResponse","options","paymentObject","wrap","_callee$","_context","prev","next","loading","sent","error","abrupt","Authorization","concat","data","success","Error","message","console","log","key","process","env","RAZORPAY_KEY","currency","amount","order_id","id","name","description","image","prefill","firstName","email","handler","response","sendPaymentSuccessEmail","verifyPayment","_objectSpread","window","Razorpay","open","on","t0","dismiss","stop","_x6","_x7","_x8","_sendPaymentSuccessEmail","_callee2","_callee2$","_context2","orderId","razorpay_order_id","paymentId","razorpay_payment_id","_x9","_x10","_x11","_x12","_verifyPayment","_callee3","bodyData","_callee3$","_context3"],"sources":["C:/Users/Farhan/Desktop/WebDevelopment/Projects/Learnify/src/services/operations/studentFeaturesAPI.js"],"sourcesContent":["import { toast } from \"react-hot-toast\";\nimport { studentEndpoints } from \"../apis\";\nimport { apiConnector } from \"../apiconnector\";\nimport rzpLogo from \"../../assets/Logo/rzp_logo.png\"\nimport { setPaymentLoading } from \"../../slices/courseSlice\";\nimport { resetCart } from \"../../slices/cartSlice\";\n\n\nconst {COURSE_PAYMENT_API, COURSE_VERIFY_API, SEND_PAYMENT_SUCCESS_EMAIL_API} = studentEndpoints;\n\nfunction loadScript(src) {\n    return new Promise((resolve) => {\n        const script = document.createElement(\"script\");\n        script.src = src;\n\n        script.onload = () => {\n            resolve(true);\n        }\n        script.onerror= () =>{\n            resolve(false);\n        }\n        document.body.appendChild(script);\n    })\n}\n\n\nexport async function buyCourse(token, courses, userDetails, navigate, dispatch) {\n    const toastId = toast.loading(\"Loading...\");\n    try{\n        //load the script\n        const res = await loadScript(\"https://checkout.razorpay.com/v1/checkout.js\");\n\n        if(!res) {\n            toast.error(\"RazorPay SDK failed to load\");\n            return;\n        }\n\n        //initiate the order\n        const orderResponse = await apiConnector(\"POST\", COURSE_PAYMENT_API, \n                                {courses},\n                                {\n                                    Authorization: `Bearer ${token}`,\n                                })\n\n        if(!orderResponse.data.success) {\n            throw new Error(orderResponse.data.message);\n        }\n        console.log(\"PRINTING orderResponse\", orderResponse);\n        //options\n        const options = {\n            key: process.env.RAZORPAY_KEY,\n            currency: orderResponse.data.message.currency,\n            amount: `${orderResponse.data.message.amount}`,\n            order_id:orderResponse.data.message.id,\n            name:\"StudyNotion\",\n            description: \"Thank You for Purchasing the Course\",\n            image:rzpLogo,\n            prefill: {\n                name:`${userDetails.firstName}`,\n                email:userDetails.email\n            },\n            handler: function(response) {\n                //send successful wala mail\n                sendPaymentSuccessEmail(response, orderResponse.data.message.amount,token );\n                //verifyPayment\n                verifyPayment({...response, courses}, token, navigate, dispatch);\n            }\n        }\n        //miss hogya tha \n        const paymentObject = new window.Razorpay(options);\n        paymentObject.open();\n        paymentObject.on(\"payment.failed\", function(response) {\n            toast.error(\"oops, payment failed\");\n            console.log(response.error);\n        })\n\n    }\n    catch(error) {\n        console.log(\"PAYMENT API ERROR.....\", error);\n        toast.error(\"Could not make Payment\");\n    }\n    toast.dismiss(toastId);\n}\n\nasync function sendPaymentSuccessEmail(response, amount, token) {\n    try{\n        await apiConnector(\"POST\", SEND_PAYMENT_SUCCESS_EMAIL_API, {\n            orderId: response.razorpay_order_id,\n            paymentId: response.razorpay_payment_id,\n            amount,\n        },{\n            Authorization: `Bearer ${token}`\n        })\n    }\n    catch(error) {\n        console.log(\"PAYMENT SUCCESS EMAIL ERROR....\", error);\n    }\n}\n\n//verify payment\nasync function verifyPayment(bodyData, token, navigate, dispatch) {\n    const toastId = toast.loading(\"Verifying Payment....\");\n    dispatch(setPaymentLoading(true));\n    try{\n        const response  = await apiConnector(\"POST\", COURSE_VERIFY_API, bodyData, {\n            Authorization:`Bearer ${token}`,\n        })\n\n        if(!response.data.success) {\n            throw new Error(response.data.message);\n        }\n        toast.success(\"payment Successful, ypou are addded to the course\");\n        navigate(\"/dashboard/enrolled-courses\");\n        dispatch(resetCart());\n    }   \n    catch(error) {\n        console.log(\"PAYMENT VERIFY ERROR....\", error);\n        toast.error(\"Could not verify Payment\");\n    }\n    toast.dismiss(toastId);\n    dispatch(setPaymentLoading(false));\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}